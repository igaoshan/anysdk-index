import{_ as s,c as a,o as l,ae as n}from"./chunks/framework.DvccZNqS.js";const o=JSON.parse('{"title":"OSS 最佳实践","description":"","frontmatter":{},"headers":[],"relativePath":"components/oss/best-practices.md","filePath":"components/oss/best-practices.md"}'),h={name:"components/oss/best-practices.md"};function t(e,i,k,p,r,d){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="oss-最佳实践" tabindex="-1">OSS 最佳实践 <a class="header-anchor" href="#oss-最佳实践" aria-label="Permalink to &quot;OSS 最佳实践&quot;">​</a></h1><h2 id="配置建议" tabindex="-1">配置建议 <a class="header-anchor" href="#配置建议" aria-label="Permalink to &quot;配置建议&quot;">​</a></h2><h3 id="_1-安全性配置" tabindex="-1">1. 安全性配置 <a class="header-anchor" href="#_1-安全性配置" aria-label="Permalink to &quot;1. 安全性配置&quot;">​</a></h3><ul><li>使用环境变量或配置中心存储敏感信息（如 AccessKey）</li><li>为不同的环境（开发、测试、生产）使用不同的存储桶</li><li>定期轮换 AccessKey</li><li>使用最小权限原则配置 IAM 策略</li></ul><h3 id="_2-性能优化" tabindex="-1">2. 性能优化 <a class="header-anchor" href="#_2-性能优化" aria-label="Permalink to &quot;2. 性能优化&quot;">​</a></h3><ul><li>合理设置分片大小（建议 5MB）</li><li>使用 CDN 加速静态资源访问</li><li>对于大文件，优先使用分片上传</li><li>适当配置缓存策略</li></ul><h3 id="_3-成本控制" tabindex="-1">3. 成本控制 <a class="header-anchor" href="#_3-成本控制" aria-label="Permalink to &quot;3. 成本控制&quot;">​</a></h3><ul><li>及时清理临时文件</li><li>使用生命周期规则自动管理文件</li><li>选择合适的存储类型（标准、低频、归档）</li><li>监控存储使用量</li></ul><h2 id="使用建议" tabindex="-1">使用建议 <a class="header-anchor" href="#使用建议" aria-label="Permalink to &quot;使用建议&quot;">​</a></h2><h3 id="_1-文件命名" tabindex="-1">1. 文件命名 <a class="header-anchor" href="#_1-文件命名" aria-label="Permalink to &quot;1. 文件命名&quot;">​</a></h3><ul><li>使用有意义的文件名</li><li>避免使用特殊字符</li><li>建议使用 UUID 或时间戳作为文件名前缀</li><li>保持目录结构清晰</li></ul><h3 id="_2-错误处理" tabindex="-1">2. 错误处理 <a class="header-anchor" href="#_2-错误处理" aria-label="Permalink to &quot;2. 错误处理&quot;">​</a></h3><ul><li>实现完善的异常处理机制</li><li>记录详细的操作日志</li><li>设置合理的重试策略</li><li>监控上传/下载失败率</li></ul><h3 id="_3-代码示例" tabindex="-1">3. 代码示例 <a class="header-anchor" href="#_3-代码示例" aria-label="Permalink to &quot;3. 代码示例&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 推荐的文件上传方式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MultipartFile file) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 生成唯一文件名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String fileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            getFileExtension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOriginalFilename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 使用分片上传处理大文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        UploadOptions options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            UploadOptions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">largeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            UploadOptions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">publicFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ossService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file, fileName, options);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OssException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;文件上传失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BusinessException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;文件上传失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="监控建议" tabindex="-1">监控建议 <a class="header-anchor" href="#监控建议" aria-label="Permalink to &quot;监控建议&quot;">​</a></h2><h3 id="_1-关键指标" tabindex="-1">1. 关键指标 <a class="header-anchor" href="#_1-关键指标" aria-label="Permalink to &quot;1. 关键指标&quot;">​</a></h3><ul><li>上传/下载成功率</li><li>响应时间</li><li>存储使用量</li><li>带宽使用情况</li><li>错误率</li></ul><h3 id="_2-告警设置" tabindex="-1">2. 告警设置 <a class="header-anchor" href="#_2-告警设置" aria-label="Permalink to &quot;2. 告警设置&quot;">​</a></h3><ul><li>存储空间使用率超过阈值</li><li>上传/下载失败率异常</li><li>响应时间异常</li><li>错误率异常</li></ul><h2 id="迁移建议" tabindex="-1">迁移建议 <a class="header-anchor" href="#迁移建议" aria-label="Permalink to &quot;迁移建议&quot;">​</a></h2><h3 id="_1-服务商迁移" tabindex="-1">1. 服务商迁移 <a class="header-anchor" href="#_1-服务商迁移" aria-label="Permalink to &quot;1. 服务商迁移&quot;">​</a></h3><ul><li>保持文件路径结构一致</li><li>使用双写策略进行平滑迁移</li><li>验证文件完整性</li><li>保留旧服务商配置作为备份</li></ul><h3 id="_2-版本升级" tabindex="-1">2. 版本升级 <a class="header-anchor" href="#_2-版本升级" aria-label="Permalink to &quot;2. 版本升级&quot;">​</a></h3><ul><li>阅读更新日志</li><li>在测试环境充分验证</li><li>制定回滚方案</li><li>选择低峰期进行升级</li></ul>`,25)]))}const c=s(h,[["render",t]]);export{o as __pageData,c as default};
